# 🔐 인증 및 회원 관리 가이드

Moment Snap 포토그래퍼 웹사이트의 회원가입, 로그인 및 관리자 권한 설정 가이드입니다.

---

## 📋 목차

1. [개요](#개요)
2. [회원가입 및 로그인](#회원가입-및-로그인)
3. [관리자 계정 설정](#관리자-계정-설정)
4. [권한 구조](#권한-구조)
5. [개인정보처리방침 및 이용약관](#개인정보처리방침-및-이용약관)

---

## 개요

이 프로젝트는 두 가지 유형의 사용자를 지원합니다:

- **일반 사용자**: 회원가입/로그인 가능, 사이트 이용
- **관리자**: 일반 사용자 권한 + 관리자 대시보드 접근 (문의 관리)

---

## 회원가입 및 로그인

### 접근 경로

- **URL**: `/auth`
- Navbar의 "로그인" 버튼을 통해 접근 가능

### 기능

1. **회원가입**
   - 이름, 이메일, 비밀번호 입력
   - 이용약관 및 개인정보처리방침 동의 (링크 제공)
   - 이메일 인증 필요 (Supabase 설정에 따라)

2. **로그인**
   - 이메일과 비밀번호로 로그인
   - 로그인 성공 시:
     - 일반 사용자: 홈페이지로 리다이렉트
     - 관리자: 관리자 대시보드로 리다이렉트

3. **로그아웃**
   - Navbar에서 로그아웃 버튼 클릭
   - 홈페이지로 리다이렉트

---

## 관리자 계정 설정

### 방법 1: Supabase 대시보드에서 직접 설정

1. **Supabase 대시보드** 접속
2. **Authentication > Users** 메뉴로 이동
3. 관리자로 지정할 사용자 클릭
4. **User Metadata** 섹션에서 "Edit" 클릭
5. 다음 JSON 추가:
   ```json
   {
     "role": "admin"
   }
   ```
6. 저장

### 방법 2: SQL Editor에서 설정

1. **Supabase 대시보드 > SQL Editor**
2. 다음 쿼리 실행:
   ```sql
   UPDATE auth.users
   SET raw_user_meta_data = raw_user_meta_data || '{"role": "admin"}'::jsonb
   WHERE email = 'your-admin@email.com';
   ```
3. `your-admin@email.com`을 실제 관리자 이메일로 변경

### 관리자 권한 확인

- 관리자로 로그인하면 Navbar에 "관리자" 버튼이 자동으로 표시됩니다
- 이 버튼을 클릭하면 관리자 대시보드(`/admin`)로 이동
- 일반 사용자가 `/admin`에 직접 접근하려고 하면 홈으로 리다이렉트됩니다

---

## 권한 구조

### 일반 사용자

- ✅ 회원가입 및 로그인
- ✅ 모든 공개 페이지 접근
- ✅ 문의 폼 작성
- ❌ 관리자 대시보드 접근 불가

### 관리자

- ✅ 모든 일반 사용자 권한
- ✅ 관리자 대시보드 접근
- ✅ 문의 내역 조회 및 삭제
- ✅ Navbar에 "관리자" 버튼 표시

### 권한 체크 로직

사용자의 권한은 Supabase의 `user_metadata` 또는 `app_metadata`의 `role` 필드로 확인됩니다:

```typescript
const checkIsAdmin = async (user: any): Promise<boolean> => {
  const role = user?.user_metadata?.role || user?.app_metadata?.role;
  return role === 'admin';
};
```

---

## 개인정보처리방침 및 이용약관

### 페이지

- **개인정보처리방침**: `/privacy`
- **이용약관**: `/terms`

### 접근 위치

1. Footer 하단에 링크 표시
2. 회원가입 시 동의 안내와 함께 링크 제공

### 내용

- 개인정보 수집 항목 및 이용 목적
- 보유 및 이용 기간
- 제3자 제공 정책
- 이용자의 권리
- 서비스 이용 약관
- 계약 성립 및 취소 정책
- 저작권 및 초상권 관련 사항

### 다국어 지원

- 한국어, 영어, 일본어 모두 지원
- 번역 파일: `src/locales/{ko,en,ja}/common.json`

---

## 🔒 보안 주의사항

### 관리자 로그인 숨김 처리

- 기존 `/login` 경로는 삭제되었습니다
- 관리자는 일반 로그인(`/auth`)에서 로그인하면 자동으로 관리자 대시보드로 이동합니다
- Footer와 공개 영역에는 관리자 로그인 링크가 표시되지 않습니다
- 관리자만 Navbar에 "관리자" 버튼이 표시됩니다

### 권한 확인

- 관리자 페이지(`/admin`)는 항상 서버사이드에서 사용자 권한을 확인합니다
- 일반 사용자가 URL을 직접 입력해도 접근할 수 없습니다

### Supabase RLS (Row Level Security)

- `contacts` 테이블:
  - 모든 사용자: INSERT 가능 (문의 작성)
  - 인증된 사용자만: SELECT, DELETE 가능
- `portfolios` 테이블:
  - 모든 사용자: SELECT 가능 (조회)
  - 인증된 사용자만: INSERT, UPDATE, DELETE 가능

---

## 📝 사용 시나리오

### 시나리오 1: 일반 사용자 회원가입

1. 사용자가 Navbar의 "로그인" 버튼 클릭
2. `/auth` 페이지로 이동
3. "회원가입" 탭으로 전환
4. 이름, 이메일, 비밀번호 입력 및 이용약관 동의
5. 회원가입 완료 후 이메일 확인
6. 이메일 인증 링크 클릭
7. 다시 로그인하여 사이트 이용

### 시나리오 2: 관리자 로그인

1. 관리자가 Navbar의 "로그인" 버튼 클릭
2. 이메일과 비밀번호 입력하여 로그인
3. 시스템이 자동으로 관리자 권한 확인
4. 자동으로 `/admin` 페이지로 리다이렉트
5. 관리자 대시보드에서 문의 관리

### 시나리오 3: 일반 사용자의 관리자 페이지 접근 시도

1. 일반 사용자가 URL에 직접 `/admin` 입력
2. 시스템이 사용자 권한 확인
3. 관리자 권한이 없으면 알림 표시: "관리자 권한이 필요합니다"
4. 자동으로 홈페이지로 리다이렉트

---

## 🎨 UI/UX 특징

### 통합 인증 페이지 (`/auth`)

- 로그인과 회원가입을 하나의 페이지에서 처리
- 탭 전환으로 간편하게 이동 가능
- 깔끔하고 모던한 디자인
- 반응형 디자인 (모바일 최적화)

### Navbar 사용자 메뉴

- 비로그인 상태: "로그인" 버튼 표시
- 로그인 상태:
  - 일반 사용자: "로그아웃" 버튼만 표시
  - 관리자: "관리자" 버튼 + "로그아웃" 버튼 표시

### 모바일 대응

- 모바일 메뉴에서도 동일한 기능 제공
- 터치 최적화
- 가독성 높은 버튼 크기

---

## 🚀 배포 후 설정

1. Supabase에서 이메일 인증 설정 확인
2. 관리자 계정 생성 및 role 설정
3. 개인정보처리방침 및 이용약관 내용 검토 및 수정 (필요 시)
4. 테스트:
   - 일반 회원가입
   - 일반 로그인
   - 관리자 로그인
   - 권한 확인

---

## ❓ FAQ

**Q: 관리자 계정은 몇 개까지 만들 수 있나요?**  
A: 제한 없습니다. 필요한 만큼 사용자에게 `role: admin`을 부여하면 됩니다.

**Q: 관리자 권한을 제거하려면?**  
A: Supabase 대시보드에서 해당 사용자의 User Metadata에서 `role` 필드를 삭제하거나 다른 값으로 변경하세요.

**Q: 이메일 인증을 비활성화하려면?**  
A: Supabase 대시보드 > Authentication > Settings > Email Auth에서 "Enable email confirmations" 옵션을 끄면 됩니다.

**Q: 비밀번호 재설정 기능은?**  
A: Supabase가 자동으로 제공합니다. 로그인 페이지에 "비밀번호 찾기" 기능을 추가하려면 `/auth` 페이지를 수정하세요.

---

**문의사항이 있으시면 개발자에게 연락하세요!** 🚀

